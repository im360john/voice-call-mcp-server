<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SMS Notification Preferences</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f5f5f5;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background-color: #fff;
            padding: 40px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        h1 {
            color: #2c3e50;
            margin-bottom: 30px;
            text-align: center;
        }

        .section {
            margin-bottom: 40px;
        }

        h2 {
            color: #34495e;
            margin-bottom: 20px;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }

        .info-box {
            background-color: #e8f4f8;
            border-left: 4px solid #3498db;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 4px;
        }

        .compliance-text {
            font-size: 14px;
            color: #666;
            margin-bottom: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 4px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }

        input[type="tel"] {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        input[type="tel"]:focus {
            outline: none;
            border-color: #3498db;
        }

        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }

        .btn {
            padding: 12px 30px;
            font-size: 16px;
            font-weight: 600;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .btn-opt-in {
            background-color: #27ae60;
            color: white;
            flex: 1;
        }

        .btn-opt-in:hover:not(:disabled) {
            background-color: #229954;
        }

        .btn-opt-out {
            background-color: #e74c3c;
            color: white;
            flex: 1;
        }

        .btn-opt-out:hover:not(:disabled) {
            background-color: #c0392b;
        }

        .message {
            margin-top: 20px;
            padding: 15px;
            border-radius: 4px;
            text-align: center;
            display: none;
        }

        .message.success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .message.error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .benefits {
            list-style: none;
            padding-left: 0;
        }

        .benefits li {
            padding: 10px 0;
            padding-left: 30px;
            position: relative;
        }

        .benefits li:before {
            content: "âœ“";
            position: absolute;
            left: 0;
            color: #27ae60;
            font-weight: bold;
            font-size: 18px;
        }

        .terms {
            margin-top: 40px;
            padding-top: 30px;
            border-top: 1px solid #ddd;
            font-size: 12px;
            color: #666;
        }

        @media (max-width: 600px) {
            .container {
                padding: 20px;
            }

            .button-group {
                flex-direction: column;
            }

            .btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>SMS Notification Preferences</h1>

        <div class="section">
            <h2>Inventory Management Notifications</h2>
            
            <div class="info-box">
                <p><strong>Stay informed about your inventory status!</strong></p>
                <p>Receive real-time SMS notifications when inventory actions are needed at your point of sale. Never miss critical stock updates again.</p>
            </div>

            <div class="compliance-text">
                <strong>10DLC Compliance Notice:</strong> This service uses 10DLC (10-Digit Long Code) messaging for business communications. Message frequency varies based on inventory events. Message and data rates may apply. Text STOP to opt out at any time. Text HELP for assistance. By opting in, you consent to receive automated inventory notifications.
            </div>

            <h3>What to Expect When You Opt In:</h3>
            <ul class="benefits">
                <li>Real-time alerts when inventory levels reach minimum thresholds</li>
                <li>Notifications for urgent restock requirements</li>
                <li>Daily inventory summary updates (optional)</li>
                <li>Critical stock-out warnings</li>
                <li>Order confirmation notifications</li>
                <li>Shipment arrival updates</li>
            </ul>
        </div>

        <div class="section">
            <h2>Manage Your Preferences</h2>
            
            <form id="smsPreferencesForm">
                <div class="form-group">
                    <label for="phoneNumber">Phone Number</label>
                    <input 
                        type="tel" 
                        id="phoneNumber" 
                        name="phoneNumber" 
                        placeholder="+1 (555) 123-4567"
                        required
                        pattern="^\+?1?\d{10,15}$"
                    >
                    <small style="color: #666;">Enter your phone number including country code</small>
                </div>

                <div class="button-group">
                    <button type="button" class="btn btn-opt-in" id="optInBtn">
                        Opt In to Notifications
                    </button>
                    <button type="button" class="btn btn-opt-out" id="optOutBtn">
                        Opt Out of Notifications
                    </button>
                </div>
            </form>

            <div id="message" class="message"></div>
        </div>

        <div class="terms">
            <p><strong>Privacy & Terms:</strong></p>
            <p>Your phone number will only be used for inventory-related notifications. We respect your privacy and will never share your information with third parties. You can opt out at any time by clicking the "Opt Out" button above or by texting STOP to any message you receive.</p>
            <p>For support, text HELP or contact our support team.</p>
        </div>
    </div>

    <script>
        const phoneInput = document.getElementById('phoneNumber');
        const optInBtn = document.getElementById('optInBtn');
        const optOutBtn = document.getElementById('optOutBtn');
        const messageDiv = document.getElementById('message');
        const form = document.getElementById('smsPreferencesForm');

        function formatPhoneNumber(value) {
            const phone = value.replace(/\D/g, '');
            const match = phone.match(/^(\d{1,3})(\d{0,3})(\d{0,3})(\d{0,4})$/);
            
            if (match) {
                let formatted = '';
                if (match[1]) {
                    formatted = match[1].length <= 3 ? match[1] : `+${match[1]}`;
                }
                if (match[2]) formatted += ` (${match[2]}`;
                if (match[3]) formatted += `) ${match[3]}`;
                if (match[4]) formatted += `-${match[4]}`;
                return formatted;
            }
            
            return value;
        }

        phoneInput.addEventListener('input', (e) => {
            const cursorPosition = e.target.selectionStart;
            const previousValue = e.target.value;
            const formatted = formatPhoneNumber(e.target.value);
            e.target.value = formatted;
            
            const diff = formatted.length - previousValue.length;
            e.target.setSelectionRange(cursorPosition + diff, cursorPosition + diff);
        });

        function showMessage(text, type) {
            messageDiv.textContent = text;
            messageDiv.className = `message ${type}`;
            messageDiv.style.display = 'block';
            
            setTimeout(() => {
                messageDiv.style.display = 'none';
            }, 5000);
        }

        function validatePhone() {
            const phone = phoneInput.value.replace(/\D/g, '');
            if (phone.length < 10 || phone.length > 15) {
                showMessage('Please enter a valid phone number', 'error');
                return false;
            }
            return true;
        }

        async function handleOptIn() {
            if (!validatePhone()) return;
            
            const phone = phoneInput.value.replace(/\D/g, '');
            optInBtn.disabled = true;
            
            try {
                const response = await fetch('/sms/preferences', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        phoneNumber: `+${phone}`,
                        action: 'opt-in'
                    })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    showMessage('Successfully opted in to SMS notifications!', 'success');
                    phoneInput.value = '';
                } else {
                    showMessage(data.error || 'Failed to opt in. Please try again.', 'error');
                }
            } catch (error) {
                showMessage('Network error. Please try again.', 'error');
            } finally {
                optInBtn.disabled = false;
            }
        }

        async function handleOptOut() {
            if (!validatePhone()) return;
            
            const phone = phoneInput.value.replace(/\D/g, '');
            optOutBtn.disabled = true;
            
            try {
                const response = await fetch('/sms/preferences', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        phoneNumber: `+${phone}`,
                        action: 'opt-out'
                    })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    showMessage('Successfully opted out of SMS notifications.', 'success');
                    phoneInput.value = '';
                } else {
                    showMessage(data.error || 'Failed to opt out. Please try again.', 'error');
                }
            } catch (error) {
                showMessage('Network error. Please try again.', 'error');
            } finally {
                optOutBtn.disabled = false;
            }
        }

        optInBtn.addEventListener('click', handleOptIn);
        optOutBtn.addEventListener('click', handleOptOut);
        
        phoneInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                e.preventDefault();
            }
        });
    </script>
</body>
</html>